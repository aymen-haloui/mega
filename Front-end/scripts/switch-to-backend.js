#!/usr/bin/env node

/**
 * Script to switch from mock data to real backend
 * Usage: node scripts/switch-to-backend.js [backend-url]
 */

import fs from 'fs';
import path from 'path';

const BACKEND_URL = process.argv[2] || 'http://localhost:8080/api';

console.log('üöÄ Switching to real backend...');
console.log(`Backend URL: ${BACKEND_URL}`);

// Create .env file
const envContent = `# Algeria Eats Hub - Environment Configuration
# Generated by switch-to-backend.js

# API Configuration
VITE_API_BASE_URL=${BACKEND_URL}
VITE_USE_MOCK_DATA=false

# WebSocket Configuration  
VITE_WS_URL=${BACKEND_URL.replace('/api', '').replace('http', 'ws')}/ws

# Development Settings
VITE_DEBUG_MODE=true
VITE_LOG_LEVEL=info

# File Upload
VITE_UPLOAD_MAX_SIZE=5242880
VITE_UPLOAD_ALLOWED_TYPES=image/jpeg,image/png,image/gif,image/webp
`;

try {
  fs.writeFileSync('.env', envContent);
  console.log('‚úÖ Created .env file');
} catch (error) {
  console.error('‚ùå Failed to create .env file:', error.message);
}

// Update mockData.ts to disable mock data
const mockDataPath = path.join('src', 'api', 'mockData.ts');

try {
  let mockDataContent = fs.readFileSync(mockDataPath, 'utf8');
  
  // Replace the shouldUseMockData function
  const oldFunction = /export const shouldUseMockData = \(\): boolean => \{[\s\S]*?\};/;
  const newFunction = `export const shouldUseMockData = (): boolean => {
  // Read from environment variable
  return import.meta.env.VITE_USE_MOCK_DATA === 'true';
};`;

  if (oldFunction.test(mockDataContent)) {
    mockDataContent = mockDataContent.replace(oldFunction, newFunction);
    fs.writeFileSync(mockDataPath, mockDataContent);
    console.log('‚úÖ Updated mockData.ts to use environment variable');
  } else {
    console.log('‚ö†Ô∏è  Could not find shouldUseMockData function to update');
  }
} catch (error) {
  console.error('‚ùå Failed to update mockData.ts:', error.message);
}

console.log('\nüéâ Backend switch completed!');
console.log('\nNext steps:');
console.log('1. Make sure your backend is running on:', BACKEND_URL);
console.log('2. Test the connection: npm run dev');
console.log('3. If you encounter issues, check the BACKEND_INTEGRATION_GUIDE.md');

console.log('\nTo switch back to mock data:');
console.log('node scripts/switch-to-mock.js');
